language: cpp
branches:
  only:
  - develop
  - release
  - "/^v[0-9]/"
env:
  global:
  - ENCRYPTION_LABEL="6d4541b72666"
  - SOLC_BUILD_TYPE=RelWithDebInfo
  - SOLC_EMSCRIPTEN=Off
  - SOLC_INSTALL_DEPS_TRAVIS=On
  - SOLC_RELEASE=On
  - SOLC_TESTS=On
  - SOLC_STOREBYTECODE=Off
  - SOLC_DOCKER=Off
  matrix:
 #   secure: VjYiHy8gYT+MRz704uCaNEJPc01dKVeIRnXeZK6FogBJvh0cwLmcx5C4/RKGpSYNUpHLV3FiyZmuTMdPDJmaTukJy2krQm+YbqQEtiB9w5UNhqjoV13jHCrhcD5ZAy5o/mBIEiKPt9vsgqnEDg2yO19SA9Fz3ZNUAmjrlkWGFBsgnqugUGLhg4LJpGjCKh18+va8KSFLciG902tigBiwKyOL4jMfdremUrLIjI46V1AhlZ0tJQJmZiO1QmqzCtodbOaMWiBrJFqQ8/+Wp2r7kHhzlF71WOLp9cSxMkTCf3g/kiqDMeRev4EzAsDHVMurzBzt8O2Prkvx+FZfBIM5ypSwpR1gljJpWXQVMt5KOhoDuHxxADDW3khRTB89NTdkMsEuIeLsa54dTUMVEOVIjZ7YKu1DKUz1GgvWHlvOoDsBjzsfMJk5I1E0NKYZvBGx6hFHvucsaHbY00+5Z6qswaAzi4fCPb0KN1WyZYeIrsmGcDzyPdlwCUajpboHo+mqToxOzvnrP7QlJoZ3EITymXrvlnZ9CHvZk72OicOFYFdgCyV5jat2w8xUCAVuPO7aKV8KrwhwEoVZbh/T6E5vdeNYgoihYGO0khBnZtTrdBr9qiEruoD5ET42MKx+euHC+eg+7ZKnB28x6E3nyJjAunFRSTYPc3A5C4VVkwrtZh8=
  include:
  - os: linux
    dist: trusty
    sudo: required
    compiler: gcc
    env:
    - ZIP_SUFFIX=ubuntu-trusty
    - SOLC_STOREBYTECODE=On
  - os: linux
    dist: trusty
    sudo: required
    compiler: clang
    env:
    - ZIP_SUFFIX=ubuntu-trusty-clang
    - SOLC_STOREBYTECODE=On
  - os: linux
    dist: trusty
    sudo: required
    services:
    - docker
    env:
#    - username=alexatshyft
    - SOLC_DOCKER=On
    - SOLC_INSTALL_DEPS_TRAVIS=Off
    - SOLC_RELEASE=Off
    - SOLC_TESTS=Off
  - os: linux
    dist: trusty
    sudo: required
    compiler: gcc
    node_js:
    - '7'
    services:
    - docker
    before_install:
    - nvm install 7
    - nvm use 7
    - docker pull trzeci/emscripten:sdk-tag-1.35.4-64bit
    env:
    - SOLC_EMSCRIPTEN=On
    - SOLC_INSTALL_DEPS_TRAVIS=Off
    - SOLC_RELEASE=Off
    - SOLC_TESTS=Off
    - ZIP_SUFFIX=emscripten
    - SOLC_STOREBYTECODE=On
git:
  depth: 2
cache:
  ccache: true
  directories:
  - boost_1_57_0
  - "$HOME/.local"
install:
- test $SOLC_INSTALL_DEPS_TRAVIS != On || (scripts/install_deps.sh)
- test "$TRAVIS_OS_NAME" != "linux" || (scripts/install_cmake.sh)
- if [ "$TRAVIS_BRANCH" = release -o -n "$TRAVIS_TAG" ]; then echo -n > prerelease.txt;
  else date -u +"nightly.%Y.%-m.%-d" > prerelease.txt; fi
- echo -n "$TRAVIS_COMMIT" > commit_hash.txt
before_script:
- test $SOLC_EMSCRIPTEN != On || (scripts/build_emscripten.sh)
- test $SOLC_DOCKER != On || (scripts/docker_build.sh)
- test $SOLC_RELEASE != On || (scripts/build.sh $SOLC_BUILD_TYPE && scripts/release.sh
  $ZIP_SUFFIX && scripts/create_source_tarball.sh)
script:
- test $SOLC_STOREBYTECODE != On || (cd $TRAVIS_BUILD_DIR && scripts/bytecodecompare/storebytecode.sh)
deploy:
- provider: script
  script: test $SOLC_EMSCRIPTEN != On || (scripts/release_emscripten.sh)
  skip_cleanup: true
  on:
    branch:
    - develop
    - release
- provider: script
  script: test $SOLC_DOCKER != On || (scripts/docker_deploy.sh)
  skip_cleanup: true
  on:
    branch:
    - develop
    - release
    - "/^v\\d/"
- provider: releases
  api_key:
    secure: PWH37xVBCF0XiSjl+eH7XIdkrfxZXjzvqF4PiBOnD3VnFz+odrdnIwBmCeBYTHTWF8efpp8fmzWJk2UVq1JcpyZiC+SVxO8dx91W2ia1a+wKrEQuDgkUrZBkl5IQNCv0QS81DDQhliyZEaYh8wHO/7RReyMpGpw2U2u85WkFiZ+LdlHEZPfzUeh9lxQ9n8qwFL8Rja+Q05d4cQ8zaVEtofJJT4T6DUWhc3TzuxDYxOmjwg37rC9CkGSLn6VadSh8b3j5R0SZupFsAEvBL/imBLP9r9ewoo7o4p6By3jwiIgH9yNg7LM618xbffcNaYF/KtLBi9uPHfqF7hRD4PlECz+D0PR78nQItOX5HKm1QMg5kCnghRVCA0IVjpV5fiYQnMLM7dCRv34I5b3zLpa69wQ/GLYB2FViqNUfvPeiZTEeIJ2OmATlFx8AH2JoqpY1XJknWb35+vMfa8LSiJJW++SLWeV+ncC92hrvyZ1cy3trepRRZIfyYepxHifnfdWMkddQUJk5b2WS5Fy/TJLZNPeombnpvRhUC38dsYItarKeXTc6k4oADCEDZ2rgGIcEiqRxXV11Y5xHJekLDWzUs+YJNcCuL4pnAP//LOnbnH2w9rLpwhQYSl0anCd097NivAXQJXO2JI/byIYz1kiCVQWnW6EM8+72mLOklf/Qr8k=
  overwrite: true
  file_glob: true
  file: "$TRAVIS_BUILD_DIR/upload/*"
  skip_cleanup: true
  on:
    all_branches: true
    tags: true
